{% extends "base.html" %}

{% block title %}Lista de Estoque{% endblock %}

{% block content %}

<h2 class="text-center mb-4">Produtos Cadastrados</h2>

<div class="card-dark shadow-soft p-3">

    <div class="d-flex justify-content-between align-items-center mb-3">

        <!-- SELECT DE CATEGORIA -->
        <select class="form-select custom-select-dark w-auto" aria-label="Status" name="category_selector"
            id="category_selector">
            <option value="">Todos</option>
            <option value="stock">Estoque</option>
            <option value="Vendidos">Vendidos</option>
            <option value="Pendentes">Pendentes</option>
        </select>

        <!-- BOTÃO ADICIONAR -->
        <a href="{% url 'create_view' %}" class="btn btn-success">
            <i class="bi bi-plus-lg"></i> Cadastrar
        </a>
    </div>

    <!-- TABELA -->
    <div class="table-responsive ">
        <table class="table table-dark-custom table-hover text-center bg-transparent">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Categoria</th>
                    <th>Quantidade</th>
                    <th>Valor de compra</th>
                    <th>Lucro</th>
                    <th>Ações</th>
                </tr>
            </thead>

            <tbody>
                {% for product in products_list %}
                <tr>
                    <td class="fw-semibold"><a href="{% url 'create_view' %}">{{product.name }}</a></td>
                    <td>{{product.category}}</td>
                    <td>{{product.quantity}}</td>
                    <td>R$ {{product.cost|floatformat:2}}</td>
                    <td class="profit-cell">R$ {{product.profit|floatformat:2}}</td>
                    <td>
                        <i class="bi bi-trash delete-icon"></i>
                    </td>
                </tr>
                {% endfor %}
                <script>
                    document.addEventListener('DOMContentLoaded', (event) => {
                        const profit_cells = document.getElementsByClassName('profit-cell');

                        Array.from(profit_cells).forEach(sale_value_element => {

                            const raw_value = sale_value_element.textContent;

                            const cleaned_value = raw_value.replace(/[^\d,\-]/g, '').replace(',', '.');

                            const sale_value = parseFloat(cleaned_value);

                            if (!isNaN(sale_value)) {
                                if (sale_value > 0) {
                                    sale_value_element.style.color = '#22C55E'; 
                                } else if (sale_value < 0) {
                                    sale_value_element.style.color = 'red'; 
                                } else
                                    sale_value_element.style.color = 'yellow'; 
                            }
                        });
                    });
                </script>
            </tbody>
        </table>
    </div>

</div>

{% endblock %}